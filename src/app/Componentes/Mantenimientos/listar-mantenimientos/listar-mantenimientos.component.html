<div class="container mt-5">
  <h2>Mantenimientos</h2>

  <!-- Bot贸n para agregar mantenimiento -->
  <button class="btn btn-primary mb-3" (click)="openModal('add')">Agregar Mantenimiento</button>

  <div class="table-responsive">
    <table class="table table-striped table-bordered table-sm">
      <thead>
        <tr>
          <th>ID</th>
          <th>Descripci贸n</th>
          <th>Fecha</th>
          <th>Equipo</th>
          <th>Responsable</th>
          <th>Tipo de Mantenimiento</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let mantenimiento of mantenimientos">
          <td>{{ mantenimiento.id }}</td>
          <td>{{ mantenimiento.descripcion }}</td>
          <td>{{ mantenimiento.fecha }}</td>
          <td>{{ mantenimiento.equipo.nombre }}</td>
          <td>{{ mantenimiento.responsable.nombre }}</td>
          <td>{{ mantenimiento.tipoMantenimiento.nombre }}</td>
          <td>
            <button class="btn btn-sm btn-primary" (click)="openModal('edit', mantenimiento)">Editar</button>
            <button class="btn btn-sm btn-danger" (click)="eliminarMantenimiento(mantenimiento.id)">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <p *ngIf="!mantenimientos || mantenimientos.length === 0">Cargando mantenimientos...</p>

  <!-- Modal para agregar mantenimiento -->
  <div *ngIf="isModalOpen && modalMode === 'add'" class="modal-backdrop">
    <div class="modal-content">
      <h3>Agregar Mantenimiento</h3>
      <form (submit)="saveMantenimiento()">
        <div class="form-group">
          <label>Descripci贸n:</label>
          <input type="text" [(ngModel)]="currentMantenimiento.descripcion" name="descripcion" class="form-control" required />
        </div>
        <div class="form-group">
          <label>Seleccionar Equipo:</label>
          <select [(ngModel)]="currentMantenimiento.equipo.id" name="equipo" class="form-control" required>
            <option *ngFor="let equipo of equipos" [value]="equipo.id">
              {{ equipo.nombre }} - {{ equipo.ubicacion }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Seleccionar Responsable:</label>
          <select [(ngModel)]="currentMantenimiento.responsable.id" name="responsable" class="form-control" required>
            <option *ngFor="let responsable of responsables" [value]="responsable.id">
              {{ responsable.nombre }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Tipo de Mantenimiento:</label>
          <select [(ngModel)]="currentMantenimiento.tipoMantenimiento.id" name="tipoMantenimiento" class="form-control" required>
            <option *ngFor="let tipo of tiposMantenimiento" [value]="tipo.id">
              {{ tipo.nombre }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Fecha:</label>
          <input type="date" [(ngModel)]="currentMantenimiento.fecha" name="fecha" class="form-control" required />
        </div>
        <div class="form-group">
          <label>Observaciones:</label>
          <textarea [(ngModel)]="currentMantenimiento.observaciones" name="observaciones" class="form-control" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label>State:</label>
          <textarea [(ngModel)]="currentMantenimiento.state" name="state" class="form-control" rows="1"></textarea>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Agregar</button>
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para editar mantenimiento -->
  <div *ngIf="isModalOpen && modalMode === 'edit'" class="modal-backdrop">
    <div class="modal-content modal-form">
      <h3>Editar Mantenimiento</h3>
      <form (submit)="saveMantenimiento()">
        <div class="form-group mb-3">
          <label>Descripci贸n:</label>
          <input type="text" [(ngModel)]="currentMantenimiento.descripcion" name="descripcion" class="form-control" required />
        </div>
        <div class="form-group mb-3">
          <label>Fecha:</label>
          <input type="date" [(ngModel)]="currentMantenimiento.fecha" name="fecha" class="form-control" required />
        </div>
        <div class="form-group mb-3">
          <label>Observaciones:</label>
          <textarea [(ngModel)]="currentMantenimiento.observaciones" name="observaciones" class="form-control" rows="3"></textarea>
        </div>
        <div class="form-group mb-3">
          <label>State:</label>
          <textarea [(ngModel)]="currentMantenimiento.state" name="state" class="form-control" rows="1"></textarea>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Guardar</button>
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>
